box: wercker/ruby
build:
  steps:
    - bundle-install
    - script:
        name: sass compile
        code: bundle exec sass --style compressed assets/scss/styles.scss:assets/css/styles.min.css --debug-info
    - script:
        name: generate staging
        code: |-
            bundle exec jekyll build --draft -t -d ./_staging
            echo '# robots.txt' > ./_staging/robots.txt
            echo 'User-agent: *' >> ./_staging/robots.txt
            echo 'Disallow: /' >> ./_staging/robots.txt
    - script:
        name: generate production
        code: |-
            bundle exec jekyll build -d -t ./_production
            echo '# robots.txt' > ./_production/robots.txt
            echo 'User-agent: *' >> ./_production/robots.txt
            echo 'Allow: /' >> ./_production/robots.txt
            echo 'Sitemap: http://born2code.net/sitemap.xml' >> ./_production.robots.txt
deploy :
  steps :
    - s3sync:
        key_id: $KEY
        key_secret: $SECRET
        bucket_url: $BUCKET
        source_dir: $SOURCE
